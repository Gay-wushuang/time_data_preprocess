ä¸‹é¢ç»™ä½ çš„æ˜¯**é¡¹ç›®çº§ç»“æ„è®¾è®¡æ–¹æ¡ˆ + å„æ–‡ä»¶èŒè´£åˆ’åˆ† + å¿…é¡»ä¿æŒçš„è¾“å‡ºæ ¼å¼è§„èŒƒ**ã€‚

æˆ‘ä¸¥æ ¼æŒ‰ç…§ä½ è¿™ä»½è„šæœ¬çš„è¡Œä¸ºæ¥è®¾è®¡ï¼Œ**è¾“å‡ºæ–‡ä»¶åã€shapeã€å¢å¼ºé€»è¾‘å…¨éƒ¨ä¿æŒä¸€è‡´**ï¼ˆåŸºäºä½ æä¾›çš„æ–‡ä»¶ ï¼‰ã€‚

ä½ å¯ä»¥ç›´æ¥äº¤ç»™ trae cn å®ç°ã€‚

---

# ä¸€ã€ç›®æ ‡ï¼šå‡çº§ä¸ºæ ‡å‡†é¡¹ç›®ç»“æ„

å½“å‰é—®é¢˜ï¼š

* æ‰€æœ‰é€»è¾‘åœ¨ä¸€ä¸ª py æ–‡ä»¶ä¸­
* æ¨¡å—è€¦åˆä¸¥é‡
* ä¸åˆ©äºæ‰©å±•
* ä¸åˆ©äºå•å…ƒæµ‹è¯•
* ä¸åˆ©äºæœªæ¥æ¥å…¥è®­ç»ƒ pipeline

ç›®æ ‡ï¼š

* æ¨¡å—è§£è€¦
* å¯ç»´æŠ¤
* æ”¯æŒå¤šæ¨¡æ€æ‰©å±•
* ä¿è¯è¾“å‡ºæ ¼å¼ **å®Œå…¨ä¸€è‡´**

---

# äºŒã€æ¨èé¡¹ç›®ç»“æ„

```
eeg_preprocess_project/
â”‚
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ default_config.py
â”‚
â”œâ”€â”€ data/
â”‚   â””â”€â”€ (åŸå§‹æ•°æ®ç›®å½•)
â”‚
â”œâ”€â”€ preprocess/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ filters.py
â”‚   â”œâ”€â”€ alignment.py
â”‚   â”œâ”€â”€ feature_extraction.py
â”‚   â”œâ”€â”€ augmentation.py
â”‚   â”œâ”€â”€ split.py
â”‚   â”œâ”€â”€ standardize.py
â”‚   â””â”€â”€ pipeline.py
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ io_utils.py
â”‚   â””â”€â”€ logger.py
â”‚
â”œâ”€â”€ features/
â”‚   â””â”€â”€ (è¾“å‡ºç›®å½•)
â”‚
â”œâ”€â”€ main.py
â””â”€â”€ requirements.txt
```

---

# ä¸‰ã€å„æ–‡ä»¶èŒè´£è®¾è®¡ï¼ˆæ ¸å¿ƒï¼‰

---

## 1ï¸âƒ£ configs/default_config.py

åªæ”¾å¸¸é‡

```python
RANDOM_SEED = 42

CSV_GROUPS = {
    'filtered': ['filtered.csv'],
    'powerspec': ['powerspec.csv'],
    'att': ['att.csv'],
    'med': ['med.csv']
}

TIME_STEPS = 10
TEST_RATIO = 0.2
NOISE_STD = 0.02
JITTER_RATIO = 0.03
MIXUP_ALPHA = 0.4

MODALITY_TYPES = {
    'filtered': 'signal',
    'powerspec': 'signal',
    'att': 'scalar',
    'med': 'scalar'
}
```

ä»¥åæ”¹å‚æ•°åªæ”¹è¿™é‡Œã€‚

---

## 2ï¸âƒ£ preprocess/filters.py

åªæ”¾æ»¤æ³¢

åŒ…å«ï¼š

* `bandpass_filter()`

å®Œå…¨æ‹·è´ä½ åŸé€»è¾‘ã€‚

---

## 3ï¸âƒ£ preprocess/alignment.py

åŒ…å«ï¼š

* `load_and_align_csv`
* `merge_csvs`

èŒè´£ï¼š
æ—¶é—´å¯¹é½ + é‡é‡‡æ · + å¤šæ–‡ä»¶åˆå¹¶

---

## 4ï¸âƒ£ preprocess/feature_extraction.py

åŒ…å«ï¼š

* `extract_time_features`
* `subsample_features`

åªè´Ÿè´£ï¼š

* é¢‘æ®µå¤„ç†
* åˆ†æ®µç»Ÿè®¡
* è¾“å‡º `(T, F)` ç»“æ„

---

## 5ï¸âƒ£ preprocess/augmentation.py

åŒ…å«ï¼š

* `time_jitter`
* `add_noise`
* `mixup`

å®Œå…¨ä¿æŒåŸé€»è¾‘ã€‚

---

## 6ï¸âƒ£ preprocess/split.py

åŒ…å«ï¼š

* `stratified_split_by_class`

---

## 7ï¸âƒ£ preprocess/standardize.py

åŒ…å«ï¼š

* `standardize_3d_features`

---

## 8ï¸âƒ£ preprocess/pipeline.py

è¿™æ˜¯æ ¸å¿ƒ orchestratorã€‚

åŒ…å«ï¼š

```
load_eeg_data_aligned
preprocess_and_save
```

å®ƒåªåšæµç¨‹ä¸²è”ï¼š

```
åŠ è½½
ç¼–ç 
åˆ’åˆ†
æ ‡å‡†åŒ–
å¢å¼º
ä¿å­˜
```

---

## 9ï¸âƒ£ utils/io_utils.py

å°è£…ï¼š

```
save_numpy()
save_joblib()
```

é¿å… pipeline é‡Œå†™å¤ªå¤š IO ä»£ç ã€‚

---

## ğŸ”Ÿ main.py

```python
from preprocess.pipeline import preprocess_and_save

if __name__ == "__main__":
    preprocess_and_save()
```

---

# å››ã€å¿…é¡»ä¿æŒçš„è¾“å‡ºæ ¼å¼ï¼ˆä¸¥æ ¼è¦æ±‚ï¼‰

âš ï¸ è¿™ä¸€éƒ¨åˆ†æ˜¯æœ€é‡è¦çš„
ä½ äº¤ç»™ trae cn æ—¶å¿…é¡»å¼ºè°ƒ **ä¸å¯æ”¹å˜**

---

## 1ï¸âƒ£ è¾“å‡ºç›®å½•

```
features/
```

---

## 2ï¸âƒ£ å¿…é¡»ç”Ÿæˆçš„æ–‡ä»¶ï¼ˆæŒ‰æ¨¡æ€ï¼‰

### è®­ç»ƒé›†

```
X_train_filtered.npy
y_train_filtered.npy

X_train_powerspec.npy
y_train_powerspec.npy

X_train_att.npy
y_train_att.npy

X_train_med.npy
y_train_med.npy
```

---

### æµ‹è¯•é›†

```
X_test_filtered.npy
y_test_filtered.npy

X_test_powerspec.npy
y_test_powerspec.npy

X_test_att.npy
y_test_att.npy

X_test_med.npy
y_test_med.npy
```

---

### å…¶ä»–æ–‡ä»¶

```
scaler_filtered.joblib
scaler_powerspec.joblib
scaler_att.joblib
scaler_med.joblib

label_encoder.joblib
onehot_encoder.joblib
```

---

# äº”ã€æ•°æ®å½¢çŠ¶å¿…é¡»ä¿æŒä¸€è‡´

æ ¹æ®ä½ å½“å‰é€»è¾‘ï¼š

---

## ä¿¡å·æ¨¡æ€ï¼ˆfiltered / powerspecï¼‰

è®­ç»ƒé›† shapeï¼š

```
(4N, T, F)
```

åŸå› ï¼š

```
åŸå§‹
+ jitter
+ noise
+ mixup
= 4å€
```

---

## æ ‡é‡æ¨¡æ€ï¼ˆatt / medï¼‰

è®­ç»ƒé›† shapeï¼š

```
(2N, T, F)
```

åŸå› ï¼š

```
åŸå§‹
+ noise
```

---

## æµ‹è¯•é›†

```
(N_test, T, F)
```

æ— å¢å¼ºã€‚

---

## æ ‡ç­¾

### è®­ç»ƒé›†

* signal â†’ onehot
* scalar â†’ onehot

### æµ‹è¯•é›†

* int label

å¿…é¡»ä¿æŒè¿™ä¸€é€»è¾‘ã€‚

---

# å…­ã€æ¶æ„å‡çº§å»ºè®®ï¼ˆå¯é€‰ä½†æ¨èï¼‰

## 1ï¸âƒ£ å¼•å…¥ Dataset ç±»

æœªæ¥è®­ç»ƒæ—¶å¯ä»¥ç›´æ¥ï¼š

```python
class EEGDataset(torch.utils.data.Dataset):
    ...
```

---

## 2ï¸âƒ£ å¢åŠ æ—¥å¿—ç³»ç»Ÿ

ä¸è¦ print
æ”¹æˆ logging

---

## 3ï¸âƒ£ å¢åŠ æ ¡éªŒæ¨¡å—

å•ç‹¬ä¸€ä¸ªï¼š

```
validator.py
```

æ£€æŸ¥ï¼š

* æ˜¯å¦å­˜åœ¨ NaN
* æ˜¯å¦ shape ä¸€è‡´
* æ˜¯å¦ label æ•°é‡åŒ¹é…

---

# ä¸ƒã€trae cn å®ç°æ—¶çš„çº¦æŸè¯´æ˜ï¼ˆä½ å¯ä»¥ç›´æ¥å¤åˆ¶ç»™ä»–ï¼‰

ä½ å¯ä»¥æŠŠä¸‹é¢è¿™æ®µè¯åŸæ ·å‘ç»™ä»–ï¼š

---

### çº¦æŸè¯´æ˜ï¼š

1. ä¸å…è®¸æ”¹å˜è¾“å‡ºæ–‡ä»¶å
2. ä¸å…è®¸æ”¹å˜è¾“å‡º shape
3. ä¸å…è®¸æ”¹å˜å¢å¼ºæ¯”ä¾‹
4. ä¸å…è®¸æ”¹å˜æ ‡ç­¾æ ¼å¼
5. ä¸å…è®¸æ”¹å˜æ ‡å‡†åŒ–é€»è¾‘
6. ä¸å…è®¸æ”¹å˜æ•°æ®å¢å¼ºé€»è¾‘
7. ä¿è¯ä¸æ—§ç‰ˆ time_data_preprocess.py è¾“å‡ºå®Œå…¨ä¸€è‡´
8. ä»…å…è®¸åšç»“æ„é‡æ„ï¼Œä¸å…è®¸è¡Œä¸ºä¿®æ”¹

---

# å…«ã€æœ€ç»ˆæ•ˆæœ

é‡æ„åä½ å°†å¾—åˆ°ï¼š

* å¯ç»´æŠ¤
* å¯æ‰©å±•
* å¯æµ‹è¯•
* å¯æ¥å…¥è®­ç»ƒ
* å·¥ä¸šçº§ç»“æ„
* è¾“å‡ºå®Œå…¨ä¸€è‡´

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å†å¸®ä½ ï¼š

* ç”»ä¸€å¼ å®Œæ•´çš„æ•°æ®æµæ¶æ„å›¾
* æˆ–è€…å¸®ä½ å‡çº§æˆæ”¯æŒå¤šæ•°æ®é›†çš„ä¼ä¸šçº§ç‰ˆæœ¬
* æˆ–è€…æ”¹æˆ Hydra / YAML é…ç½®é©±åŠ¨ç‰ˆæœ¬

ä½ è¿™ä¸ªç»“æ„å·²ç»æ¥è¿‘è®ºæ–‡çº§ pipeline äº†ï¼Œç¨å¾®æ•´ç†å°±æ˜¯éå¸¸æ ‡å‡†çš„ç ”ç©¶å·¥ç¨‹ä»£ç ã€‚
